<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="height=device-height,width=device-width,initial-scale=1,minimum-scale=1"><meta name=generator content="Hugo 0.119.0"><meta name=generator content="Relearn 5.20.0+tip"><meta name=description content><title>High-level architecture :: XAPI Toolstack Developer Documentation</title><link href=/toolstack/high-level/index.xml rel=alternate type=application/rss+xml title="High-level architecture :: XAPI Toolstack Developer Documentation"><link href=/images/favicon.png?1695996435 rel=icon type=image/png><link href=/css/fontawesome-all.min.css?1695996435 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fontawesome-all.min.css?1695996435 rel=stylesheet></noscript><link href=/css/nucleus.css?1695996435 rel=stylesheet><link href=/css/auto-complete.css?1695996435 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/auto-complete.css?1695996435 rel=stylesheet></noscript><link href=/css/perfect-scrollbar.min.css?1695996435 rel=stylesheet><link href=/css/fonts.css?1695996435 rel=stylesheet media=print onload='this.media="all",this.onload=null'><noscript><link href=/css/fonts.css?1695996435 rel=stylesheet></noscript><link href=/css/theme.css?1695996435 rel=stylesheet><link href=/css/theme-red.css?1695996435 rel=stylesheet id=variant-style><link href=/css/variant.css?1695996435 rel=stylesheet><link href=/css/print.css?1695996435 rel=stylesheet media=print><link href=/css/ie.css?1695996435 rel=stylesheet><script src=/js/url.js?1695996435></script>
<script src=/js/variant.js?1695996435></script>
<script>window.index_js_url="/index.search.js";var root_url="/",baseUriFull,baseUri=root_url.replace(/\/$/,"");window.T_Copy_to_clipboard="Copy to clipboard",window.T_Copied_to_clipboard="Copied to clipboard!",window.T_Copy_link_to_clipboard="Copy link to clipboard",window.T_Link_copied_to_clipboard="Copied link to clipboard!",window.T_No_results_found="No results found for \"{0}\"",window.T_N_results_found="{1} results found for \"{0}\"",baseUriFull="/",window.variants&&variants.init(["red"])</script></head><body class="mobile-support html" data-url=/toolstack/high-level/index.html><div id=body class=default-animation><div id=sidebar-overlay></div><div id=toc-overlay></div><nav id=topbar class=highlightable><div><div class=navigation><a class="nav nav-next topbar-link" href=/toolstack/high-level/environment/index.html title="Environment (&#129106;)"><i class="fas fa-chevron-right fa-fw"></i></a></div><div class=navigation><a class="nav nav-prev topbar-link" href=/toolstack/responsibilities/index.html title="Responsibilities (&#129104;)"><i class="fas fa-chevron-left fa-fw"></i></a></div><div id=breadcrumbs><span id=sidebar-toggle-span><a href=# id=sidebar-toggle class=topbar-link title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a></span><ol class=links itemscope itemtype=http://schema.org/BreadcrumbList><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/index.html><span itemprop=name>XAPI Toolstack Developer Guide</span></a><meta itemprop=position content="1">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><a itemprop=item href=/toolstack/index.html><span itemprop=name>The XAPI Toolstack</span></a><meta itemprop=position content="2">&nbsp;>&nbsp;</li><li itemscope itemtype=https://schema.org/ListItem itemprop=itemListElement><span itemprop=name>High-level architecture</span><meta itemprop=position content="3"></li></ol></div></div></nav><main id=body-inner class="highlightable default" tabindex=-1><div class=flex-block-wrapper><article class=default><header class=headline></header><h1 id=high-level-architecture>High-level architecture</h1><p>The XAPI Toolstack manages a cluster of hosts, network switches and storage on
behalf of clients such as <a href=https://github.com/xenserver/xenadmin target=_blank>XenCenter</a>
and <a href=https://xen-orchestra.com target=_blank>Xen Orchestra</a>.</p><p>The most fundamental concept is of a <em>Resource pool</em>: the whole cluster managed
as a single entity. The following diagram shows a cluster of hosts running
xapi, all sharing some storage:</p><p><a href=#image-aae631640b47507331f1fa50ce177732 class=lightbox-link><img src=/toolstack/high-level/pool.png alt="A Resource Pool" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-aae631640b47507331f1fa50ce177732><img src=/toolstack/high-level/pool.png alt="A Resource Pool" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>At any time, at most one host is known as the <em>pool coordinator</em> (formerly
known as &ldquo;master&rdquo;) and is responsible for coordination and locking resources
within the pool. When a pool is first created a coordinator host is chosen. The
coordinator role can be transferred</p><ul><li>on user request in an orderly fashion (<code>xe pool-designate-new-master</code>)</li><li>on user request in an emergency (<code>xe pool-emergency-transition-to-master</code>)</li><li>automatically if HA is enabled on the cluster.</li></ul><p>All hosts expose an HTTP, XML-RPC and JSON-RPC interface running on port 80 and
with TLS on port 443, but control operations will only be processed on the
coordinator host. Attempts to send a control operation to another host will
result in a XenAPI redirect error message. For efficiency the following
operations are permitted on non-coordinator hosts:</p><ul><li>querying performance counters (and their history)</li><li>connecting to VNC consoles</li><li>import/export (particularly when disks are on local storage)</li></ul><p>Since the coordinator host acts as coordinator and lock manager, the other
hosts will often talk to the coordinator. Non-coordinator hosts will also talk
to each other (over the same HTTP and RPC channels) to</p><ul><li>transfer VM memory images (<em>VM migration</em>)</li><li>mirror disks (<em>storage migration</em>)</li></ul><p>Note that some types of shared storage (in particular all those using vhd)
require coordination for disk GC and coalesce. This coordination is currently
done by xapi and hence it is not possible to share this kind of storage between
resource pools.</p><p>The following diagram shows the software running on a single host. Note that
all hosts run the same software (although not necessarily the same version, if
we are in the middle of a rolling update).</p><p><a href=#image-5edeff16f60bf6473b1675f41d18efac class=lightbox-link><img src=/toolstack/high-level/host.png alt="A Host" class="figure-image noborder lightbox noshadow" style=height:auto;width:auto loading=lazy></a>
<a href=javascript:history.back(); class=lightbox-back id=image-5edeff16f60bf6473b1675f41d18efac><img src=/toolstack/high-level/host.png alt="A Host" class="lightbox-image noborder lightbox noshadow" loading=lazy></a></p><p>The XAPI Toolstack expects the host to be running Xen on x86. The Xen
hypervisor partitions the host into <em>Domains</em>, some of which can have
privileged hardware access, and the rest are unprivileged guests. The XAPI
Toolstack normally runs all of its components in the privileged initial domain,
Domain 0, also known as &ldquo;the control domain&rdquo;. However there is experimental
code which supports &ldquo;driver domains&rdquo; allowing storage and networking drivers to
be isolated in their own domains.</p><ul class="children children-li children-sort-"><li><a href=/toolstack/high-level/environment/index.html>Environment</a><ul></ul></li><li><a href=/toolstack/high-level/daemons/index.html>Daemons</a><ul></ul></li><li><a href=/toolstack/high-level/interfaces/index.html>Interfaces</a><ul></ul></li></ul><footer class=footline></footer></article></div></main></div><aside id=sidebar class=default-animation><div id=header-topbar class=default-animation></div><div id=header-wrapper class=default-animation><div id=header class=default-animation><img src=/images/xapi-project.png></div><div class="searchbox default-animation"><i class="fas fa-search" title="Search (CTRL+ALT+f)"></i>
<label class=a11y-only for=search-by>Search</label>
<input data-search-input id=search-by name=search-by class=search-by type=search placeholder=Search...>
<button class=search-clear type=button data-search-clear title="Clear search"><i class="fas fa-times" title="Clear search"></i></button></div><script>var contentLangs=["en"]</script><script src=/js/auto-complete.js?1695996435 defer></script>
<script src=/js/lunr/lunr.min.js?1695996435 defer></script>
<script src=/js/lunr/lunr.stemmer.support.min.js?1695996435 defer></script>
<script src=/js/lunr/lunr.multi.min.js?1695996435 defer></script>
<script src=/js/lunr/lunr.en.min.js?1695996435 defer></script>
<script src=/js/search.js?1695996435 defer></script></div><div id=homelinks class="default-animation homelinks"><ul><li><a class=padding href=/index.html><i class="fas fa-home"></i> Home</a></li></ul><hr class=padding></div><div id=content-wrapper class=highlightable><div id=topics><ul class="enlarge morespace collapsible-menu"><li data-nav-id=/toolstack/index.html class=parent><input type=checkbox id=section-733bfb8b221c6a3949d666444cf4445d aria-controls=subsections-733bfb8b221c6a3949d666444cf4445d checked><label for=section-733bfb8b221c6a3949d666444cf4445d><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu The Toolstack</span></label><a class=padding href=/toolstack/index.html>The Toolstack</a><ul id=subsections-733bfb8b221c6a3949d666444cf4445d class="morespace collapsible-menu"><li data-nav-id=/toolstack/responsibilities/index.html><a class=padding href=/toolstack/responsibilities/index.html>Responsibilities</a></li><li data-nav-id=/toolstack/high-level/index.html class="active parent"><input type=checkbox id=section-93d1c0b933c799c336ad0fd09a6dc0ae aria-controls=subsections-93d1c0b933c799c336ad0fd09a6dc0ae checked><label for=section-93d1c0b933c799c336ad0fd09a6dc0ae><i class="fas fa-chevron-down"></i><i class="fas fa-chevron-right"></i><span class=a11y-only>Submenu High-level architecture</span></label><a class=padding href=/toolstack/high-level/index.html>High-level architecture</a><ul id=subsections-93d1c0b933c799c336ad0fd09a6dc0ae class="morespace collapsible-menu"><li data-nav-id=/toolstack/high-level/environment/index.html><a class=padding href=/toolstack/high-level/environment/index.html>Environment</a></li><li data-nav-id=/toolstack/high-level/daemons/index.html><a class=padding href=/toolstack/high-level/daemons/index.html>Daemons</a></li><li data-nav-id=/toolstack/high-level/interfaces/index.html><a class=padding href=/toolstack/high-level/interfaces/index.html>Interfaces</a></li></ul></li></ul></li></ul></div><div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter"></div><div id=menu-footer><hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter"><div id=prefooter class="footerLangSwitch footerVariantSwitch footerVisitedLinks"><ul><li id=select-language-container class=footerLangSwitch><div class="padding menu-control"><i class="fas fa-language fa-fw"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=select-language>Language</label>
<select id=select-language onchange="location=baseUri+this.value"></select></div><div class=clear></div></div></li><li id=select-variant-container class=footerVariantSwitch><div class="padding menu-control"><i class="fas fa-paint-brush fa-fw"></i>
<span>&nbsp;</span><div class=control-style><label class=a11y-only for=select-variant>Theme</label>
<select id=select-variant onchange=window.variants&&variants.changeVariant(this.value)><option id=red value=red selected>Red</option></select></div><div class=clear></div></div><script>window.variants&&variants.markSelectedVariant()</script></li><li class=footerVisitedLinks><div class="padding menu-control"><i class="fas fa-history fa-fw"></i>
<span>&nbsp;</span><div class=control-style><button onclick=clearHistory()>Clear History</button></div><div class=clear></div></div></li></ul></div><div id=footer class=footerFooter></div></div></div></aside><script src=/js/clipboard.min.js?1695996435 defer></script>
<script src=/js/perfect-scrollbar.min.js?1695996435 defer></script>
<script src=/js/theme.js?1695996435 defer></script></body></html>